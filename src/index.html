<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Kuoia | Acceso</title>
    <meta
      name="description"
      content="Pantalla de acceso de Kuoia con estilo limpio, claro y profesional."
    />
    <meta name="supabase-url" content="https://mmgnwvxzjyaowukeudan.supabase.co" />
    <meta name="supabase-anon-key" content="sb_publishable_JaBwfDNhZEsVIn85l7odZQ_xB2jWygb" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <div class="background-layer" aria-hidden="true">
      <canvas id="networkCanvas" class="network-canvas"></canvas>
      <span class="blob blob-1"></span>
      <span class="blob blob-2"></span>
    </div>

    <header class="topbar">
      <a href="#" class="logo" aria-label="Inicio Kuoia">
        <img src="assets/kuoia-logo.svg" alt="Kuoia" class="logo-mark" />
        <span>Kuoia</span>
      </a>
      <button class="btn btn-secondary topbar-cta hidden" id="topbarAuthCta" type="button">
        Entrar o registrarse
      </button>
    </header>

    <main>
      <section class="auth-shell" id="authView">
        <div class="auth-stack">
          <section class="auth-card" id="authCard" aria-label="Acceso de usuario">
            <div class="auth-header">
              <p class="eyebrow">Bienvenido a Kuoia</p>
              <h1>Reg√≠strate y empieza a vender o comprar</h1>
              <p class="subtitle">Todo en un solo lugar para colegios, familias y recursos educativos.</p>
            </div>

            <div class="auth-toggle" role="tablist" aria-label="Seleccionar panel de acceso">
              <button class="toggle-btn active" id="loginTab" role="tab" aria-selected="true" aria-controls="loginPanel" type="button">
                Iniciar sesi√≥n
              </button>
              <button class="toggle-btn" id="registerTab" role="tab" aria-selected="false" aria-controls="registerPanel" type="button">
                Crear cuenta
              </button>
            </div>

            <div class="auth-panels">
              <form class="auth-form active" id="loginPanel" role="tabpanel" aria-labelledby="loginTab">
                <label>
                  Correo electr√≥nico
                  <input type="email" name="email" placeholder="tu@email.com" required />
                </label>
                <label>
                  Contrase√±a
                  <input type="password" name="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required />
                </label>
                <button class="btn btn-primary" type="submit">Entrar</button>
              </form>

              <form class="auth-form" id="registerPanel" role="tabpanel" aria-labelledby="registerTab" hidden>
                <label>
                  Nombre de usuario
                  <input type="text" name="displayName" placeholder="Tu nombre o el de tu centro" required />
                </label>
                <label>
                  Perfil
                  <select name="identity" required>
                    <option value="" selected disabled>Selecciona una opci√≥n</option>
                    <option value="centro-educativo">Centro educativo</option>
                    <option value="academica">Acad√©mica</option>
                    <option value="particular">Particular</option>
                  </select>
                </label>
                <label>
                  Correo electr√≥nico
                  <input type="email" name="email" placeholder="tu@email.com" required />
                </label>
                <label>
                  Contrase√±a
                  <input type="password" name="password" placeholder="M√≠nimo 8 caracteres" minlength="8" required />
                </label>
                <button class="btn btn-primary" type="submit">Crear cuenta</button>
              </form>
            </div>
          </section>

        </div>
      </section>

      <section class="subscriptions-view hidden" id="subscriptionsView" aria-label="Planes de suscripci√≥n">
        <header class="subscriptions-header">
          <div>
            <p class="eyebrow">Elige tu plan</p>
            <h2>Suscripciones Kuoia para cada necesidad</h2>
            <p class="subtitle">Compara funciones, precios y escala cuando quieras.</p>
          </div>
          <button class="btn btn-secondary" id="subscriptionsBackButton" type="button">Volver</button>
        </header>
        <div class="plans-grid">
          <article class="plan-card plan-gray">
            <h3>Gris ¬∑ Esencial</h3>
            <p class="plan-price">9‚Ç¨<span>/mes</span></p>
            <ul>
              <li>Acceso b√°sico al cat√°logo</li>
              <li>1 perfil de usuario</li>
              <li>Soporte por email</li>
            </ul>
            <button class="btn btn-primary plan-select-btn" type="button" data-plan="Esencial">Suscribirse al plan</button>
          </article>
          <article class="plan-card plan-green">
            <h3>Verde ¬∑ B√°sico</h3>
            <p class="plan-price">19‚Ç¨<span>/mes</span></p>
            <ul>
              <li>Todo lo del plan Esencial</li>
              <li>Hasta 5 perfiles</li>
              <li>Automatizaciones iniciales</li>
            </ul>
            <button class="btn btn-primary plan-select-btn" type="button" data-plan="B√°sico">Suscribirse al plan</button>
          </article>
          <article class="plan-card plan-blue">
            <h3>Azul ¬∑ Premium</h3>
            <p class="plan-price">39‚Ç¨<span>/mes</span></p>
            <ul>
              <li>Funciones avanzadas premium</li>
              <li>Usuarios ilimitados</li>
              <li>Anal√≠ticas, API y soporte prioritario</li>
            </ul>
            <button class="btn btn-primary plan-select-btn" type="button" data-plan="Premium">Suscribirse al plan</button>
          </article>
        </div>

        <div class="plan-columns" aria-label="Comparativa de planes en columnas">
          <article>
            <h4>Esencial</h4>
            <p>Ideal para empezar.</p>
          </article>
          <article>
            <h4>B√°sico</h4>
            <p>Para centros en crecimiento.</p>
          </article>
          <article>
            <h4>Premium</h4>
            <p>Todo desbloqueado para escalar.</p>
          </article>
        </div>
      </section>

      <section class="marketplace hidden" id="marketplaceView" aria-label="Pantalla principal din√°mica">
        <div class="marketplace-header">
          <div>
            <p class="eyebrow">Panel principal</p>
            <h2>Recursos y productos de la comunidad</h2>
            <p class="subtitle" id="welcomeMessage">Explora lo que la comunidad comparte hoy.</p>
          </div>
          <div class="header-actions">
            <button class="status-chip" id="chatRegistryButton" type="button" aria-live="polite">
              üí¨ Chats
            </button>
            <img id="headerAvatar" class="header-avatar" alt="Avatar de perfil" />
            <button class="btn btn-primary" id="uploadProductButton" type="button">Subir producto</button>
            <button class="btn btn-secondary" id="marketplaceSubscriptionsButton" type="button">Suscripciones</button>
            <button class="btn btn-secondary" id="profileButton" type="button">Perfil</button>
            <button class="btn btn-secondary" id="logoutButton" type="button">Cerrar sesi√≥n</button>
          </div>
        </div>

        <div class="marketplace-layout">
          <aside class="filters-panel">
            <h3>Filtros</h3>
            <label class="search-label" for="searchInput">
              Buscador
              <input id="searchInput" type="search" placeholder="Busca por producto, recurso o vendedor" />
            </label>

            <label class="filter-label" for="locationFilter">
              Localidad
              <select id="locationFilter">
                <option value="">Todas</option>
                <option value="madrid">Madrid</option>
                <option value="barcelona">Barcelona</option>
                <option value="valencia">Valencia</option>
                <option value="sevilla">Sevilla</option>
              </select>
            </label>

            <label class="filter-label" for="centerFilter">
              Centro educativo
              <select id="centerFilter">
                <option value="">Todos</option>
                <option value="publico">P√∫blico</option>
                <option value="concertado">Concertado</option>
                <option value="privado">Privado</option>
              </select>
            </label>

            <label class="filter-label" for="typeFilter">
              Tipo
              <select id="typeFilter">
                <option value="">Todos</option>
                <option value="producto">Producto</option>
                <option value="recurso">Recurso</option>
                <option value="servicio">Servicio</option>
              </select>
            </label>

            <label class="filter-label" for="priceRange">
              Precio m√°ximo
              <div class="range-wrap">
                <input id="priceRange" type="range" min="5" max="400" step="5" value="400" />
                <strong id="priceRangeValue">Hasta 400 ‚Ç¨</strong>
              </div>
            </label>
          </aside>

          <section class="products-panel">
            <div class="results-meta" id="resultsMeta">Mostrando 0 resultados.</div>
            <div class="marketplace-grid" id="marketplaceGrid"></div>
            <p class="empty-state hidden" id="emptyState">No se encontraron productos con esos filtros.</p>
          </section>
        </div>
      </section>

      <section class="upload-product-view hidden" id="uploadProductView" aria-label="Subir producto">
        <div class="upload-product-card">
          <header class="upload-product-header">
            <div>
              <p class="eyebrow">Publica tu producto</p>
              <h2>Subir nuevo producto</h2>
              <p class="subtitle">Completa los datos para publicar tu producto en el marketplace.</p>
            </div>
            <button class="btn btn-secondary" id="uploadProductBackButton" type="button">Volver</button>
          </header>

          <form id="uploadProductForm" class="upload-product-form">
            <label>
              Nombre del producto
              <input type="text" name="title" placeholder="Ej: Mochila escolar ergon√≥mica" required />
            </label>
            <label>
              Foto del producto
              <input type="file" name="photo" accept="image/*" required />
            </label>
            <label>
              Precio (‚Ç¨)
              <input type="number" name="price" min="1" step="0.01" placeholder="0.00" required />
            </label>
            <label>
              Descripci√≥n
              <textarea name="description" rows="4" placeholder="Describe el estado, uso y detalles del producto" required></textarea>
            </label>
            <label>
              Direcci√≥n de env√≠o
              <input type="text" name="shippingAddress" placeholder="Calle, ciudad, c√≥digo postal" required />
            </label>
            <label>
              Tama√±o
              <input type="text" name="size" placeholder="Ej: 35 x 20 x 15 cm" required />
            </label>
            <label>
              Peso (kg)
              <input type="number" name="weight" min="0.1" step="0.1" placeholder="Ej: 1.5" required />
            </label>
            <label class="checkbox-field">
              <input type="checkbox" name="promotional" />
              <span>¬øQuieres promocionar este producto a todos los centros educativos durante 10 d√≠as?</span>
            </label>

            <div class="upload-product-actions">
              <button class="btn btn-primary" type="submit">Subir producto</button>
            </div>
          </form>
        </div>
      </section>

      <section class="chat-registry-view hidden" id="chatRegistryView" aria-label="Chats 1:1 activos e inactivos">
        <div class="chat-registry-card">
          <header class="chat-registry-header">
            <div>
              <p class="eyebrow">Historial</p>
              <h2>Chats 1:1</h2>
              <p class="subtitle">Crea un chat por email y entra a tus conversaciones en tiempo real.</p>
            </div>
            <button class="btn btn-secondary" id="chatRegistryBackButton" type="button">Volver al inicio</button>
          </header>

          <form id="newChatForm" class="new-chat-form">
            <label for="newChatEmail">Nuevo chat por email</label>
            <div class="chat-input-row">
              <input id="newChatEmail" name="email" type="email" placeholder="usuario@dominio.com" required />
              <button class="btn btn-primary" type="submit">Crear / abrir</button>
            </div>
          </form>

          <p class="chat-status" id="chatRegistryStatus" role="status" aria-live="polite"></p>
          <div class="chat-registry-list" id="chatRegistryList"></div>
        </div>
      </section>


      <section class="chat-view hidden" id="chatView" aria-label="Chat 1:1">
        <div class="chat-card">
          <header class="chat-header">
            <div>
              <p class="eyebrow">Mensajes</p>
              <h2 id="chatTitle">Conversaci√≥n</h2>
              <p class="subtitle">Mensajer√≠a privada en tiempo real con usuarios autenticados.</p>
            </div>
            <button class="btn btn-secondary" id="chatBackButton" type="button">Volver al inicio</button>
          </header>

          <section class="chat-highlight" aria-label="Resumen de conversaci√≥n">
            <div>
              <p class="chat-contact-name" id="chatContactName">Usuario</p>
              <p class="chat-product-meta">Conversation ID: <span id="chatProductName">-</span></p>
            </div>
            <p class="chat-product-price" id="chatProductPrice">En l√≠nea</p>
          </section>

          <p class="chat-status" id="chatDetailStatus" role="status" aria-live="polite"></p>

          <div class="chat-messages" id="chatMessages"></div>

          <form id="chatForm" class="chat-form">
            <label for="chatInput">Responder</label>
            <div class="chat-input-row">
              <input id="chatInput" name="message" type="text" placeholder="Escribe una respuesta..." required />
              <button class="btn btn-primary" type="submit">Enviar</button>
            </div>
          </form>
        </div>
      </section>

      <section class="profile-view hidden" id="profileView" aria-label="Perfil de la cuenta dentro de Kuoia">
        <div class="profile-card">
          <div>
            <p class="eyebrow">Tu perfil de Kuoia</p>
            <h2>Configuraci√≥n de tu cuenta</h2>
            <p class="subtitle">Esta pantalla pertenece a la app y no abre tu perfil personal externo.</p>
          </div>
          <form id="profileForm" class="profile-form">
            <label>
              Nombre visible
              <input type="text" name="displayName" placeholder="Ej: Colegio San Miguel" required />
            </label>
            <label>
              Rol
              <select name="role" required>
                <option value="centro-educativo">Centro educativo</option>
                <option value="particular">Particular</option>
                <option value="academica">Acad√©mica</option>
              </select>
            </label>
            <label>
              Ciudad
              <input type="text" name="city" placeholder="Tu localidad" required />
            </label>
            <label>
              Plan actual
              <input type="text" name="currentPlan" id="currentPlanInput" readonly />
            </label>
            <div class="avatar-editor">
              <p class="avatar-editor-title">Imagen de perfil</p>
              <div class="avatar-editor-content">
                <img id="profileAvatarPreview" class="profile-avatar-preview" alt="Vista previa del avatar" />
                <div class="avatar-editor-controls">
                  <label for="avatarUpload" class="btn btn-secondary avatar-upload-label">Subir foto o logo</label>
                  <input id="avatarUpload" name="avatarUpload" type="file" accept="image/*" />
                  <button class="btn btn-secondary" id="generateAvatarButton" type="button">Crear avatar gen√©rico</button>
                </div>
              </div>
            </div>
            <div class="profile-actions">
              <button class="btn btn-secondary" id="profileSubscriptionsButton" type="button">Suscripciones</button>
              <button class="btn btn-primary" type="submit">Guardar perfil</button>
              <button class="btn btn-secondary" id="profileBackButton" type="button">Volver al inicio</button>
            </div>
          </form>
        </div>
      </section>
    </main>

    <div class="toast" id="toast" role="status" aria-live="polite"></div>

    <script type="module" src="app.js"></script>
  </body>
</html>
